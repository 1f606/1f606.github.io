---
layout:     post
title:      小程序总结
subtitle:   
date:       2022-7-13
author:     sq
header-img: 
catalog: true
tags:
    - 小程序
---
# 小程序总结
## swiper 组件
swiper 根元素需要设置宽高，不能自适应。

swiper 相关元素的类：

```
.wx-swiper-dots ： 指示点容器样式
.wx-swiper-dots-horizontal ： 水平滑动的指示点容器样式，其在.wx-swiper-dots同一个元素上。
.wx-swiper-dot ：指示点样式
.wx-swiper-dot-active ： 当前指示点样式
```

## 使用 sass

## image 高度自适应
设置 image 的宽度以及 `mode="widthFix"`

## onReachBottom 页面触底
自定义组件中这个方法不生效，页面才生效。

## 页面和组件传值

### 组件监听页面传入的数据变化
```javascript
{
  properties: {
    list: {
      type: Array,
      observer: function (newValue, oldValue) {
      }
    }
  }
}
```

### 组件向页面传递数据
组件：
```javascript
this.triggerEvent('eventName', '222');
```

页面：
```html
<component bind:eventName="handleEventName"></component>
```

### 页面调用组件函数
页面给组件设置唯一的id：
```html
<component id="uniqueId"></component>
```

```javascript
this.selectComponent('#uniqueId').componentFunction();
```

### 组件调用页面函数
可以通过事件，或者通过 getCurrentPages() 拿到当前页面，因为组件并不会放入页面栈。

```javascript
const pages = getCurrentPages();
// 然后就可以获取页面的数据，方法等。
const currentPage = pages[pages.length - 1];
const data = currentPage.data;
```

### 获取 app 定义的全局数据或函数
```javascript
getApp().globalData
getApp().func()
```

## 获取授权流程
先调用 `wx.getSetting`，返回结果的 authSetting 是否有对应的权限。

如需要调用 `wx.getLocation`，判断 `scope.userLocation` 是否为 true。true 就直接调用对应api，false 需要调用 `wx.showModal`，设置 title
和 content 引导用户打开设置，点击同意后调用 `wx.openSetting`，在回调中拿到 authSetting，判断是否有对应api权限，有就调用对应api。没有就设置
默认值或等待用户下次点击再次调用方法。

如果 `wx.getSetting` 返回的 authSetting 中没有对应的权限，说明没有调用过对应api，直接调用。

## 小程序登录流程
`uni.getUserProfile` 或通过 `button-type="getPhoneNumber"` 的 button 拿到 encryptedData 和 iv，`uni.login` 拿到 code（getPhoneNumber可以直接拿到） 再用这三个作为参数，请求后台接口获取用户信息。

如果内置的 webview 也需要登录，可以约定一个一次性 code，在获取用户信息时一并请求，作为地址传给 webview，让 webview 获取用户信息。

## 获取用户手机号，头像和昵称方法

```html
<button open-type="getUserInfo" bindgetuserinfo="test"></button>
<button open-type="getPhoneNumber" bindgetphonenumber="test"></button>

<button open-type="chooseAvatar" bindchooseavatar="test"></button>
<!--用户昵称 在此input输入时，键盘上会有用户昵称显示，微信也会异步安全检测用户名，未通过就清空。msgSecCheck接口
建议通过form-type为submit的button手机输入信息-->
<form action="">
    <input type="nickname"/>
    <button form-type="submit"></button>
</form>
```

## 小程序和 webview 通信
wx.miniProgram.navigateTo

wx.miniProgram.postMessage，message事件

## 小程序分享
1. 用户点击原生分享按钮或开发者定义的 open-type 是 share 的按钮,会触发 onShareAppMessage 处理函数（和 onLoad 等生命周期函数同级），设置该页
面的分享信息。该函数需要返回一个对象自定义分享内容。
2. 调用 uni.showShareMenu 传入自定义分享内容


## 资料
[1] https://developers.weixin.qq.com/miniprogram/dev/framework/open-ability/authorize.html

// TODO
https://www.cnblogs.com/masterchd/p/10901624.html
