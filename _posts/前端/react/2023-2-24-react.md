---
layout:     post
title:      react
subtitle:   
date:       2023-2-24
author:     
header-img:
catalog: true
tags:
    - React
---
# React
## JSX
- JSX ä¼šç§»é™¤è¡Œé¦–å°¾çš„ç©ºæ ¼ä»¥åŠç©ºè¡Œã€‚ä¸æ ‡ç­¾ç›¸é‚»çš„ç©ºè¡Œå‡ä¼šè¢«åˆ é™¤ï¼Œæ–‡æœ¬å­—ç¬¦ä¸²ä¹‹é—´çš„æ–°è¡Œä¼šè¢«å‹ç¼©ä¸ºä¸€ä¸ªç©ºæ ¼ã€‚
- å¸ƒå°”ç±»å‹ã€Null ä»¥åŠ Undefined ä½œä¸ºprops.childrenå°†ä¼šå¿½ç•¥ã€‚è¿™æœ‰åŠ©äºä¾æ®ç‰¹å®šæ¡ä»¶æ¥æ¸²æŸ“å…¶ä»–çš„ React å…ƒç´ ã€‚`{showHeader && <Header />}`ã€‚falsyä»ä¼šè¢«æ¸²æŸ“ï¼Œç¡®ä¿è¡¨è¾¾å¼æ€»æ˜¯å¸ƒå°”å€¼ã€‚[â€œfalsyâ€](https://developer.mozilla.org/en-US/docs/Glossary/Falsy) å€¼

```javascript
// è¡¨è¾¾å¼
const name = 'Josh Perez';
const element = <h1>Hello, {name}</h1>;
// å­—é¢é‡å±æ€§  
const element = <div tabIndex="0"></div>;
// è¡¨è¾¾å¼å±æ€§
const element = <img src={user.avatarUrl}></img>;
```

## å›¾ç‰‡å¼•å…¥åå¯ç›´æ¥ç”¨åœ¨å•æ‹¬å·å†…
```
import logo from './logo.svg';

<img src={logo} className="App-logo" alt="logo" />
```

### åœ¨ JSX ç±»å‹ä¸­ä½¿ç”¨ç‚¹è¯­æ³•
```javascript
const MyComponents = {
  DatePicker: function DatePicker(props) {
    return <div>Imagine a {props.color} datepicker here.</div>;
  }
}

function BlueDatePicker() {
  return <MyComponents.DatePicker color="blue" />;
}
```

## æ¡ä»¶æ¸²æŸ“
å¤§æ‹¬å·å†…ä½¿ç”¨ä¸‰å…ƒè¡¨è¾¾å¼åˆ¤æ–­ï¼›if-else/switch case/ç­–ç•¥æ¨¡å¼ æ§åˆ¶æ¸²æŸ“çš„å˜é‡çš„å€¼ï¼›å¤§æ‹¬å·å†…ä½¿ç”¨ &&ï¼›ç©ºå€¼åˆå¹¶è¿ç®—ç¬¦ã€‚

### JSX é˜²æ­¢æ³¨å…¥æ”»å‡»
æ‰€æœ‰çš„å†…å®¹åœ¨æ¸²æŸ“ä¹‹å‰éƒ½è¢«è½¬æ¢æˆäº†å­—ç¬¦ä¸²ã€‚è¿™æ ·å¯ä»¥æœ‰æ•ˆåœ°é˜²æ­¢XSSæ”»å‡»

### åœ¨è¿è¡Œæ—¶é€‰æ‹©ç±»å‹
```javascript
function Story(props) {
  // æ­£ç¡®ï¼JSX ç±»å‹å¯ä»¥æ˜¯å¤§å†™å­—æ¯å¼€å¤´çš„å˜é‡ã€‚
  const SpecificStory = components[props.storyType];
  return <SpecificStory story={props.story} />;
}
```

### å­—ç¬¦ä¸²å­—é¢é‡
ä½ å¯ä»¥å°†å­—ç¬¦ä¸²å­—é¢é‡èµ‹å€¼ç»™ prop. å¦‚ä¸‹ä¸¤ä¸ª JSX è¡¨è¾¾å¼æ˜¯ç­‰ä»·çš„ï¼š
```javascript
<MyComponent message="hello world" />

<MyComponent message={'hello world'} />
```

å½“ä½ å°†å­—ç¬¦ä¸²å­—é¢é‡èµ‹å€¼ç»™ prop æ—¶ï¼Œå®ƒçš„å€¼æ˜¯æœªè½¬ä¹‰çš„ã€‚æ‰€ä»¥ï¼Œä»¥ä¸‹ä¸¤ä¸ª JSX è¡¨è¾¾å¼æ˜¯ç­‰ä»·çš„ï¼š
```javascript
<MyComponent message="&lt;3" />

<MyComponent message={'<3'} />
```

### å±æ€§å±•å¼€
```javascript
function App2() {
  const props = {firstName: 'Ben', lastName: 'Hector'};
  return <Greeting {...props} />;
}
```

## ç»„ä»¶
ç»„ä»¶åç§°å¿…é¡»ä»¥å¤§å†™å­—æ¯å¼€å¤´ã€‚ React ä¼šå°†ä»¥å°å†™å­—æ¯å¼€å¤´çš„ç»„ä»¶è§†ä¸ºåŸç”Ÿ DOM æ ‡ç­¾ã€‚

ç»„ä»¶åˆ†ä¸ºå‡½æ•°ç»„ä»¶å’Œç±»ç»„ä»¶ã€‚å‡½æ•°ç»„ä»¶æ˜¯ä¸€ä¸ªè¿”å› jsx çš„å‡½æ•°ã€‚ç±»ç»„ä»¶åœ¨ render æ–¹æ³•ä¸­è¿”å› jsxã€‚

tsx æ–‡ä»¶è¦å¼•å…¥ `react`ï¼Œå¯¼å‡ºä¸€ä¸ªå‡½æ•°ç»„ä»¶ã€‚

```javascript
// å‚æ•°ä¸­æ¥æ”¶props
function Welcome(props) {
  return <h1>Hello, {props.name}</h1>;
}

class Welcome extends React.Component {
  render() {
    // render å‡½æ•°ä¸­å¯ä»¥è®¿é—® props
    return <h1>Hello, {this.props.name}</h1>;
  }
}
```

#### è®¾ç½®é»˜è®¤ props å’Œç±»å‹

```javascript
import PropTypes from "prop-types";

class Modal extends Component {
  static propTypes = {
    isOpen: PropTypes.bool.isRequired,
  }
  
  static defaultProps = {
    isOpen: false
  }
}
```

### propsåªè¯»æ€§
æ‰€æœ‰ React ç»„ä»¶éƒ½å¿…é¡»åƒçº¯å‡½æ•°ä¸€æ ·ä¿æŠ¤å®ƒä»¬çš„ props ä¸è¢«æ›´æ”¹ã€‚

ä½ å¯ä»¥å°†ä»»ä½•ä¸œè¥¿ä½œä¸º props è¿›è¡Œä¼ é€’ã€‚

### çº¯å‡½æ•°
ä¸ä¼šæ›´æ”¹å…¥å‚ï¼Œä¸”å¤šæ¬¡è°ƒç”¨ä¸‹ç›¸åŒçš„å…¥å‚å§‹ç»ˆè¿”å›ç›¸åŒçš„ç»“æœã€‚

## State
- classç»„ä»¶ä¸­åœ¨constructorä¸­ä¸ºthis.stateèµ‹åˆå§‹å€¼
- é€šè¿‡this.setState()æ›´æ–°ç»„ä»¶state
- Stateçš„æ›´æ–°å¯èƒ½æ˜¯å¼‚æ­¥çš„
- Stateçš„æ›´æ–°ä¼šè¢«åˆå¹¶

```javascript
this.setState(Object);
this.setState((prevState, props) => Object);
```

## ç”Ÿå‘½å‘¨æœŸ
componentDidMount() æ–¹æ³•ä¼šåœ¨ç»„ä»¶å·²ç»è¢«æ¸²æŸ“åˆ° DOM ä¸­åè¿è¡Œ

### shouldComponentUpdate
å¦‚æœä½ çŸ¥é“åœ¨ä»€ä¹ˆæƒ…å†µä¸‹ä½ çš„ç»„ä»¶ä¸éœ€è¦æ›´æ–°ï¼Œä½ å¯ä»¥åœ¨ shouldComponentUpdate ä¸­è¿”å› false æ¥è·³è¿‡æ•´ä¸ªæ¸²æŸ“è¿‡ç¨‹ã€‚å…¶åŒ…æ‹¬è¯¥ç»„ä»¶çš„ render è°ƒç”¨ä»¥åŠä¹‹åçš„æ“ä½œã€‚
åœ¨å¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œä½ å¯ä»¥ç»§æ‰¿ React.PureComponent ä»¥ä»£æ›¿æ‰‹å†™ shouldComponentUpdate()ã€‚å®ƒç”¨å½“å‰ä¸ä¹‹å‰ props å’Œ state çš„æµ…æ¯”è¾ƒè¦†å†™äº† shouldComponentUpdate() çš„å®ç°ã€‚
ä½†ä»–åªè¿›è¡Œæµ…æ¯”è¾ƒï¼Œæ‰€ä»¥å½“ props æˆ–è€… state æŸç§ç¨‹åº¦æ˜¯å¯å˜çš„è¯ï¼Œé‚£ä½ å°±ä¸èƒ½ä½¿ç”¨å®ƒäº†ã€‚

### getDerivedStateFromProps
getDerivedStateFromProps ä¼šåœ¨è°ƒç”¨ render æ–¹æ³•ä¹‹å‰è°ƒç”¨ï¼Œå³åœ¨æ¸²æŸ“ DOM å…ƒç´ ä¹‹å‰ä¼šè°ƒç”¨ï¼Œå¹¶ä¸”åœ¨åˆå§‹æŒ‚è½½åŠåç»­æ›´æ–°æ—¶éƒ½ä¼šè¢«è°ƒç”¨ã€‚
è¯¥æ–¹æ³•è¿”å›ä¸€ä¸ªå¯¹è±¡ç”¨äºæ›´æ–° stateï¼Œå¦‚æœè¿”å› null åˆ™ä¸æ›´æ–°ä»»ä½•å†…å®¹ã€‚

## äº‹ä»¶å¤„ç†
- React äº‹ä»¶çš„å‘½åé‡‡ç”¨å°é©¼å³°å¼ï¼ˆcamelCaseï¼‰ï¼Œè€Œä¸æ˜¯çº¯å°å†™ã€‚
- ä½¿ç”¨ JSX è¯­æ³•æ—¶ä½ éœ€è¦ä¼ å…¥ä¸€ä¸ªå‡½æ•°ä½œä¸ºäº‹ä»¶å¤„ç†å‡½æ•°ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ã€‚
- äº‹ä»¶å¤„ç†å‡½æ•°éœ€è¦åœ¨constructorä¸­ç»‘å®šthisæŒ‡å‘

```html
<button onclick="handleClick()"></button>
<button onClick={this.handleClick}></button>
```
Reactä¸èƒ½é€šè¿‡è¿”å› false çš„æ–¹å¼é˜»æ­¢é»˜è®¤è¡Œä¸ºã€‚ä½ å¿…é¡»æ˜¾å¼çš„ä½¿ç”¨ preventDefault

## æ¡ä»¶æ¸²æŸ“
### ä¸è¿ç®—ç¬¦&&
å¦‚æœæ˜¯ falseï¼ŒReact ä¼šå¿½ç•¥å¹¶è·³è¿‡å®ƒã€‚
```javascript
return (
  {list.length > 0 && <h2>You have {list.length} unread messages.</h2>}
);
```

### é˜»æ­¢ç»„ä»¶æ¸²æŸ“
```javascript
return null
```

## åˆ—è¡¨åŠKEY
ä¸å»ºè®®ä½¿ç”¨ç´¢å¼•æ¥ç”¨ä½œ key å€¼ï¼Œå¦‚æœä½ é€‰æ‹©ä¸æŒ‡å®šæ˜¾å¼çš„ key å€¼ï¼Œé‚£ä¹ˆ React å°†é»˜è®¤ä½¿ç”¨ç´¢å¼•ç”¨ä½œä¸ºåˆ—è¡¨é¡¹ç›®çš„ key å€¼ã€‚
```javascript
const listItems = numbers.map((number) =>
    <li key={number.toString()}>
      {number}
    </li>
  );
  return (
    <ul>{listItems}</ul>
  );
```

### ç”¨ key æå–ç»„ä»¶
- å…ƒç´ çš„ key åªæœ‰æ”¾åœ¨å°±è¿‘çš„æ•°ç»„ä¸Šä¸‹æ–‡ä¸­æ‰æœ‰æ„ä¹‰ã€‚
- ä¸€ä¸ªå¥½çš„ç»éªŒæ³•åˆ™æ˜¯ï¼šåœ¨ map() æ–¹æ³•ä¸­çš„å…ƒç´ éœ€è¦è®¾ç½® key å±æ€§ã€‚
- key åªæ˜¯åœ¨å…„å¼ŸèŠ‚ç‚¹ä¹‹é—´å¿…é¡»å”¯ä¸€
- key ä¼šä¼ é€’ä¿¡æ¯ç»™ React ï¼Œä½†ä¸ä¼šä¼ é€’ç»™ä½ çš„ç»„ä»¶ã€‚å¦‚æœç»„ä»¶ä¸­éœ€è¦ä½¿ç”¨ key å±æ€§çš„å€¼ï¼Œè¯·ç”¨å…¶ä»–å±æ€§åæ˜¾å¼ä¼ é€’è¿™ä¸ªå€¼ï¼š

ä¾‹å­ï¼šæ­£ç¡®çš„ä½¿ç”¨ key çš„æ–¹å¼
```javascript
function ListItem(props) {
  // æ­£ç¡®ï¼è¿™é‡Œä¸éœ€è¦æŒ‡å®š keyï¼š
  return <li>{props.value}</li>;
}

function NumberList(props) {
  const numbers = props.numbers;
  const listItems = numbers.map((number) =>
    // æ­£ç¡®ï¼key åº”è¯¥åœ¨æ•°ç»„çš„ä¸Šä¸‹æ–‡ä¸­è¢«æŒ‡å®š
    <ListItem key={number.toString()} value={number} />
  );
  return (
    <ul>
      {listItems}
    </ul>
  );
}
```

## è¡¨å•
### å—æ§ç»„ä»¶
ä½¿ React çš„ state æˆä¸ºâ€œå”¯ä¸€æ•°æ®æºâ€ã€‚æ¸²æŸ“è¡¨å•çš„ React ç»„ä»¶è¿˜æ§åˆ¶ç€ç”¨æˆ·è¾“å…¥è¿‡ç¨‹ä¸­è¡¨å•å‘ç”Ÿçš„æ“ä½œã€‚è¢« React ä»¥è¿™ç§æ–¹å¼æ§åˆ¶å–å€¼çš„è¡¨å•è¾“å…¥å…ƒç´ å°±å«åšâ€œå—æ§ç»„ä»¶â€ã€‚
å¯¹äºå—æ§ç»„ä»¶æ¥è¯´ï¼Œè¾“å…¥çš„å€¼å§‹ç»ˆç”± React çš„ state é©±åŠ¨ã€‚

#### æ³¨æ„
åœ¨å—æ§ç»„ä»¶ä¸ŠæŒ‡å®š value çš„ prop ä¼šé˜»æ­¢ç”¨æˆ·æ›´æ”¹è¾“å…¥ã€‚ å¦‚æœä½ æŒ‡å®šäº† valueï¼Œä½†è¾“å…¥ä»å¯ç¼–è¾‘ï¼Œåˆ™å¯èƒ½æ˜¯ä½ æ„å¤–åœ°å°†value è®¾ç½®ä¸º undefined æˆ– nullã€‚
```javascript
ReactDOM.render(<input value="hi" />, mountNode);

setTimeout(function() {
  ReactDOM.render(<input value={null} />, mountNode);
}, 1000);
```
### éå—æ§ç»„ä»¶
è¦ç¼–å†™ä¸€ä¸ªéå—æ§ç»„ä»¶ï¼Œè€Œä¸æ˜¯ä¸ºæ¯ä¸ªçŠ¶æ€æ›´æ–°éƒ½ç¼–å†™æ•°æ®å¤„ç†å‡½æ•°ï¼Œä½ å¯ä»¥ ä½¿ç”¨ ref æ¥ä» DOM èŠ‚ç‚¹ä¸­è·å–è¡¨å•æ•°æ®ã€‚
#### é»˜è®¤å€¼
```javascript
<input type="input"><input type="checkbox"> å’Œ <input type="radio"> æ”¯æŒ defaultCheckedï¼Œ<select> å’Œ <textarea> æ”¯æŒ defaultValueã€‚
```
### å—æ§ç»„ä»¶å’Œéå—æ§ç»„ä»¶çš„é€‰æ‹©
https://goshakkk.name/controlled-vs-uncontrolled-inputs-react/
### textarea
åœ¨ HTML ä¸­, <textarea> å…ƒç´ é€šè¿‡å…¶å­å…ƒç´ å®šä¹‰å…¶æ–‡æœ¬
è€Œåœ¨ React ä¸­ï¼Œ<textarea> ä½¿ç”¨ value å±æ€§ä»£æ›¿ã€‚
### select
åœ¨ HTML ä¸­ï¼Œ<select> åˆ›å»ºä¸‹æ‹‰åˆ—è¡¨æ ‡ç­¾ã€‚ selected å±æ€§æ§åˆ¶optionæ˜¯å¦é»˜è®¤è¢«é€‰ä¸­ã€‚
React å¹¶ä¸ä¼šä½¿ç”¨ selected å±æ€§ï¼Œè€Œæ˜¯åœ¨æ ¹ select æ ‡ç­¾ä¸Šä½¿ç”¨ value å±æ€§ã€‚
#### å¤šé€‰
ä½ å¯ä»¥å°†æ•°ç»„ä¼ é€’åˆ° value å±æ€§ä¸­ï¼Œä»¥æ”¯æŒåœ¨ select æ ‡ç­¾ä¸­é€‰æ‹©å¤šä¸ªé€‰é¡¹
```javascript
// <select multiple={true} value={['B', 'C']}>
```
### æ–‡ä»¶inputæ ‡ç­¾
å®ƒå§‹ç»ˆæ˜¯ä¸€ä¸ªéå—æ§ç»„ä»¶ï¼Œå› ä¸ºå®ƒçš„å€¼åªèƒ½ç”±ç”¨æˆ·è®¾ç½®ï¼Œè€Œä¸èƒ½é€šè¿‡ä»£ç æ§åˆ¶ã€‚
### å¤„ç†å¤šä¸ªè¾“å…¥
```javascript
const name = target.name;

this.setState({
  [name]: value
});
```
## çŠ¶æ€æå‡
åœ¨ React åº”ç”¨ä¸­ï¼Œä»»ä½•å¯å˜æ•°æ®åº”å½“åªæœ‰ä¸€ä¸ªç›¸å¯¹åº”çš„å”¯ä¸€â€œæ•°æ®æºâ€ã€‚
é€šå¸¸ï¼Œstate éƒ½æ˜¯é¦–å…ˆæ·»åŠ åˆ°éœ€è¦æ¸²æŸ“æ•°æ®çš„ç»„ä»¶ä¸­å»ã€‚
ç„¶åï¼Œå¦‚æœå…¶ä»–ç»„ä»¶ä¹Ÿéœ€è¦è¿™ä¸ª stateï¼Œé‚£ä¹ˆä½ å¯ä»¥å°†å®ƒæå‡è‡³è¿™äº›ç»„ä»¶çš„æœ€è¿‘å…±åŒçˆ¶ç»„ä»¶ä¸­ã€‚
ä½ åº”å½“ä¾é è‡ªä¸Šè€Œä¸‹çš„æ•°æ®æµï¼Œè€Œä¸æ˜¯å°è¯•åœ¨ä¸åŒç»„ä»¶é—´åŒæ­¥ stateã€‚
## ç»„åˆä¸ç»§æ‰¿
### props.children
æœ‰äº›ç»„ä»¶æ— æ³•æå‰çŸ¥æ™“å®ƒä»¬å­ç»„ä»¶çš„å…·ä½“å†…å®¹ï¼Œå»ºè®®è¿™äº›ç»„ä»¶ä½¿ç”¨ä¸€ä¸ªç‰¹æ®Šçš„ children prop æ¥å°†ä»–ä»¬çš„å­ç»„ä»¶ä¼ é€’åˆ°æ¸²æŸ“ç»“æœä¸­ã€‚
JSX æ ‡ç­¾ä¸­çš„æ‰€æœ‰å†…å®¹éƒ½ä¼šä½œä¸ºä¸€ä¸ª children prop ä¼ é€’ç»™ç»„ä»¶ã€‚
å¦å¤–å¯è‡ªè¡Œçº¦å®šï¼šå°†æ‰€éœ€å†…å®¹ä¼ å…¥ propsï¼Œå¹¶ä½¿ç”¨ç›¸åº”çš„ propã€‚
#### å‡½æ•°ä½œä¸ºå­å…ƒç´ 
é€šå¸¸ï¼ŒJSX ä¸­çš„ JavaScript è¡¨è¾¾å¼å°†ä¼šè¢«è®¡ç®—ä¸ºå­—ç¬¦ä¸²ã€React å…ƒç´ æˆ–è€…æ˜¯åˆ—è¡¨ã€‚
ä¸è¿‡ï¼Œprops.children å’Œå…¶ä»– prop ä¸€æ ·ï¼Œå®ƒå¯ä»¥ä¼ é€’ä»»æ„ç±»å‹çš„æ•°æ®ï¼Œè€Œä¸ä»…ä»…æ˜¯ React å·²çŸ¥çš„å¯æ¸²æŸ“ç±»å‹ã€‚
ä¾‹å¦‚ï¼Œå¦‚æœä½ æœ‰ä¸€ä¸ªè‡ªå®šä¹‰ç»„ä»¶ï¼Œä½ å¯ä»¥æŠŠå›è°ƒå‡½æ•°ä½œä¸º props.children è¿›è¡Œä¼ é€’ï¼š
```javascript
// è°ƒç”¨å­å…ƒç´ å›è°ƒ numTimes æ¬¡ï¼Œæ¥é‡å¤ç”Ÿæˆç»„ä»¶
function Repeat(props) {
  let items = [];
  for (let i = 0; i < props.numTimes; i++) {
    items.push(props.children(i));
  }
  return <div>{items}</div>;
}

function ListOfTenThings() {
  return (
    <Repeat numTimes={10}>
      {(index) => <div key={index}>This is item {index} in the list</div>}
    </Repeat>
  );
}
```
### å…³äºç»§æ‰¿
æˆ‘ä»¬å¹¶æ²¡æœ‰å‘ç°éœ€è¦ä½¿ç”¨ç»§æ‰¿æ¥æ„å»ºç»„ä»¶å±‚æ¬¡çš„æƒ…å†µã€‚
## æ— éšœç¢ï¼ˆa11yï¼‰
https://react.docschina.org/docs/accessibility.html
### æ ‡å‡†å’ŒæŒ‡å—
[ç½‘ç»œå†…å®¹æ— éšœç¢æŒ‡å—ï¼ˆWeb Content Accessibility Guidelinesï¼ŒWCAGï¼‰](https://www.w3.org/WAI/intro/wcag) ä¸ºå¼€å‘æ— éšœç¢ç½‘ç«™æä¾›äº†æŒ‡å—ã€‚

ä¸‹é¢çš„ WCAG æ£€æŸ¥è¡¨æä¾›äº†ä¸€äº›æ¦‚è§ˆï¼š

[Wuhcag æä¾›çš„ WCAG æ£€æŸ¥è¡¨ï¼ˆWCAG checklist from Wuhcagï¼‰](https://www.wuhcag.com/wcag-checklist/)
[WebAIM æä¾›çš„ WCAG æ£€æŸ¥è¡¨ï¼ˆWCAG checklist from WebAIMï¼‰](https://webaim.org/standards/wcag/checklist)
[A11Y Project æä¾›çš„æ£€æŸ¥è¡¨ï¼ˆChecklist from The A11Y Projectï¼‰](https://a11yproject.com/checklist.html)
### WAI-ARIA
[ç½‘ç»œæ— éšœç¢å€¡è®® - æ— éšœç¢äº’è”ç½‘åº”ç”¨ï¼ˆWeb Accessibility Initiative - Accessible Rich Internet Applicationsï¼‰](https://www.w3.org/WAI/intro/aria) æ–‡ä»¶åŒ…å«äº†åˆ›å»ºå®Œå…¨æ— éšœç¢ JavaScript éƒ¨ä»¶æ‰€éœ€è¦çš„æŠ€æœ¯ã€‚
JSX æ”¯æŒæ‰€æœ‰ aria-* HTML å±æ€§ã€‚aria-* åº”è¯¥åƒå…¶åœ¨ HTML ä¸­ä¸€æ ·ä½¿ç”¨å¸¦è¿å­—ç¬¦çš„å‘½åæ³•ã€‚

### è¯­ä¹‰åŒ–çš„ HTML
[MDN çš„ HTML å…ƒç´ å‚ç…§ï¼ˆMDN HTML elements referenceï¼‰](https://developer.mozilla.org/en-US/docs/Web/HTML/Element)
æœ‰æ—¶ï¼Œè¯­ä¹‰åŒ–çš„ HTML ä¼šè¢«ç ´åã€‚æ¯”å¦‚å½“åœ¨ JSX ä¸­ä½¿ç”¨ <div> å…ƒç´ æ¥å®ç° React ä»£ç åŠŸèƒ½çš„æ—¶å€™ï¼Œåˆæˆ–æ˜¯åœ¨ä½¿ç”¨åˆ—è¡¨ï¼ˆ<ol>ï¼Œ <ul> å’Œ <dl>ï¼‰å’Œ HTML <table> æ—¶ã€‚ 
åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬åº”è¯¥ä½¿ç”¨ React Fragments æ¥ç»„åˆå„ä¸ªç»„ä»¶ã€‚
ä¾‹å­ï¼š
```javascript
import React, { Fragment } from 'react';

function ListItem({ item }) {
  return (
    <Fragment>
      <dt>{item.term}</dt>
      <dd>{item.description}</dd>
    </Fragment>
  );
}

function Glossary(props) {
  return (
    <dl>
      {props.items.map(item => (
        <ListItem item={item} key={item.id} />
      ))}
    </dl>
  );
}
// å½“ä½ ä¸éœ€è¦åœ¨ fragment æ ‡ç­¾ä¸­æ·»åŠ ä»»ä½• prop ä¸”ä½ çš„å·¥å…·æ”¯æŒçš„æ—¶å€™ï¼Œä½ å¯ä»¥ä½¿ç”¨ çŸ­è¯­æ³•ï¼š

function ListItem({ item }) {
  return (
    <>
      <dt>{item.term}</dt>
      <dd>{item.description}</dd>
    </>
  );
}
```
## æ— éšœç¢è¡¨å•
### æ ‡è®°
æ‰€æœ‰çš„ HTML è¡¨å•æ§åˆ¶ï¼Œä¾‹å¦‚ <input> å’Œ <textarea> ï¼Œéƒ½éœ€è¦è¢«æ ‡æ³¨æ¥å®ç°æ— éšœç¢è¾…åŠ©åŠŸèƒ½ã€‚æˆ‘ä»¬éœ€è¦æä¾›å±å¹•æœ—è¯»å™¨ä»¥è§£é‡Šæ€§æ ‡æ³¨ã€‚
ä»¥ä¸‹èµ„æºå‘æˆ‘ä»¬å±•ç¤ºäº†å¦‚ä½•å†™æ ‡æ³¨ï¼š
- [W3C å‘æˆ‘ä»¬å±•ç¤ºå¦‚ä½•æ ‡æ³¨å…ƒç´ ](https://www.w3.org/WAI/tutorials/forms/labels/)
- [WebAIM å‘æˆ‘ä»¬å±•ç¤ºå¦‚ä½•æ ‡æ³¨å…ƒç´ ](https://webaim.org/techniques/forms/controls)
- [Paciello Group è§£é‡Šä»€ä¹ˆæ˜¯æ— éšœç¢åç§°](https://www.paciellogroup.com/blog/2017/04/what-is-an-accessible-name/)
æ³¨æ„ï¼šfor åœ¨ JSX ä¸­åº”è¯¥è¢«å†™ä½œ htmlFor

### åœ¨å‡ºé”™æ—¶æé†’ç”¨æˆ·
å½“å‡ºç°é”™è¯¯æ—¶ï¼Œæ‰€æœ‰ç”¨æˆ·éƒ½åº”è¯¥çŸ¥æƒ…ã€‚ä¸‹é¢çš„é“¾æ¥å‘Šè¯‰æˆ‘ä»¬å¦‚ä½•ç»™å±å¹•æœ—è¯»å™¨è®¾ç½®é”™è¯¯ä¿¡æ¯ï¼š
[W3C å±•ç¤ºç”¨æˆ·æ¨é€](https://www.w3.org/WAI/tutorials/forms/notifications/)
[WebAIM å…³äºè¡¨å•æ ¡éªŒçš„æ–‡ç« ](https://webaim.org/techniques/formvalidation/)

### æ§åˆ¶ç„¦ç‚¹
ç¡®ä¿ä½ çš„ç½‘ç»œåº”ç”¨åœ¨å³ä½¿åªæ‹¥æœ‰é”®ç›˜çš„ç¯å¢ƒä¸‹æ­£å¸¸è¿ä½œã€‚
[WebAIM è®¨è®ºä½¿ç”¨é”®ç›˜è¿›è¡Œæ— éšœç¢è®¿é—®](https://webaim.org/techniques/keyboard/)

### é”®ç›˜ç„¦ç‚¹åŠç„¦ç‚¹è½®å»“
é”®ç›˜ç„¦ç‚¹çš„å®šä¹‰æ˜¯ï¼šåœ¨ DOM ä¸­ï¼Œå½“å‰è¢«é€‰ä¸­æ¥æ¥å—é”®ç›˜ä¿¡æ¯çš„å…ƒç´ ã€‚
æˆ‘ä»¬å¯ä»¥åœ¨å„å¤„çœ‹åˆ°é”®ç›˜ç„¦ç‚¹ï¼Œå®ƒä¼šè¢«ç„¦ç‚¹è½®å»“åŒ…å›´ï¼Œè¯·ä¸è¦ä½¿ç”¨ CSS ç§»é™¤è¿™ä¸ªè½®å»“ï¼Œæ¯”å¦‚è®¾ç½® outline: 0ï¼Œé™¤éä½ å°†ä½¿ç”¨å…¶ä»–çš„æ–¹æ³•å®ç°ç„¦ç‚¹è½®å»“ã€‚

### è·³è¿‡å†…å®¹æœºåˆ¶
ä¸ºäº†å¸®åŠ©å’Œæé€Ÿé”®ç›˜å¯¼èˆªï¼Œæˆ‘ä»¬æä¾›äº†ä¸€ç§æœºåˆ¶ï¼Œå¯ä»¥å¸®åŠ©ç”¨æˆ·è·³è¿‡ä¸€äº›å¯¼èˆªæ®µè½ã€‚

è·³è½¬é“¾æ¥ï¼ˆSkiplinksï¼‰ï¼Œæˆ–è€…è¯´è·³è½¬å¯¼èˆªé“¾æ¥ï¼ˆSkip Navigation Linksï¼‰æ˜¯ä¸€ç§éšè—çš„å¯¼èˆªé“¾æ¥ï¼Œå®ƒåªä¼šåœ¨ä½¿ç”¨é”®ç›˜å¯¼èˆªæ—¶å¯è§ã€‚ä½¿ç”¨ç½‘é¡µå†…éƒ¨é”šç‚¹å’Œä¸€äº›å¼æ ·å¯ä»¥å¾ˆå®¹æ˜“åœ°å®ç°å®ƒï¼š
- [WebAIM - è·³è½¬å¯¼èˆªé“¾æ¥ï¼ˆSkip Navigation Linksï¼‰](https://webaim.org/techniques/skipnav/)
å¦å¤–ï¼Œä½¿ç”¨åœ°æ ‡å…ƒç´ å’Œè§’è‰²ï¼Œæ¯”å¦‚ <main> å’Œ <aside>ï¼Œä½œä¸ºè¾…åŠ©æ¥åˆ’åˆ†ç½‘é¡µçš„åŒºåŸŸå¯ä»¥è®©ç”¨æˆ·å¿«é€Ÿå¯¼èˆªè‡³è¿™äº›éƒ¨åˆ†ã€‚

ä½ å¯ä»¥é€šè¿‡ä¸‹é¢çš„é“¾æ¥äº†è§£æ›´å¤šå¦‚ä½•ä½¿ç”¨è¿™äº›å…ƒç´ æ¥å¢å¼ºæ— éšœç¢è¾…åŠ©åŠŸèƒ½ï¼š
[æ— éšœç¢åœ°æ ‡](https://www.scottohara.me/blog/2018/03/03/landmarks.html)

### ä½¿ç”¨ç¨‹åºç®¡ç†ç„¦ç‚¹
æˆ‘ä»¬çš„ React åº”ç”¨åœ¨è¿è¡Œæ—¶ä¼šæŒç»­æ›´æ”¹ HTML DOMï¼Œæœ‰æ—¶è¿™å°†ä¼šå¯¼è‡´é”®ç›˜ç„¦ç‚¹çš„ä¸¢å¤±æˆ–è€…æ˜¯è¢«è®¾ç½®åˆ°äº†æ„æ–™ä¹‹å¤–çš„å…ƒç´ ä¸Šã€‚
ä¸ºäº†ä¿®å¤è¿™ç±»é—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦ä»¥ç¼–ç¨‹çš„æ–¹å¼è®©é”®ç›˜èšç„¦åˆ°æ­£ç¡®çš„æ–¹å‘ä¸Šã€‚æ¯”æ–¹è¯´ï¼Œåœ¨ä¸€ä¸ªå¼¹çª—è¢«å…³é—­çš„æ—¶å€™ï¼Œé‡æ–°è®¾ç½®é”®ç›˜ç„¦ç‚¹åˆ°å¼¹çª—çš„æ‰“å¼€æŒ‰é’®ä¸Šã€‚

MDN Web æ–‡æ¡£å…³æ³¨äº†è¿™ä¸ªé—®é¢˜å¹¶å‘æˆ‘ä»¬è§£é‡Šäº†å¯ä»¥å¦‚ä½•æ­å»º[å¯ç”¨é”®ç›˜å¯¼èˆªçš„ JavaScript éƒ¨ä»¶]ã€‚(https://developer.mozilla.org/en-US/docs/Web/Accessibility/Keyboard-navigable_JavaScript_widgets)

æˆ‘ä»¬å¯ä»¥ç”¨ DOM å…ƒç´ çš„ Refs åœ¨ React ä¸­è®¾ç½®ç„¦ç‚¹ã€‚

ç”¨ä»¥ä¸ŠæŠ€æœ¯ï¼Œæˆ‘ä»¬å…ˆåœ¨ä¸€ä¸ª class ç»„ä»¶çš„ JSX ä¸­åˆ›å»ºä¸€ä¸ªå…ƒç´ çš„ refï¼š
```javascript
class CustomTextInput extends React.Component {
  constructor(props) {
    super(props);
    // åˆ›é€ ä¸€ä¸ª textInput DOM å…ƒç´ çš„ ref
    this.textInput = React.createRef();
  }
  render() {
  // ä½¿ç”¨ `ref` å›è°ƒå‡½æ•°ä»¥åœ¨å®ä¾‹çš„ä¸€ä¸ªå˜é‡ä¸­å­˜å‚¨æ–‡æœ¬è¾“å…¥ DOM å…ƒç´ 
  //ï¼ˆæ¯”å¦‚ï¼Œthis.textInputï¼‰ã€‚
    return (
      <input
        type="text"
        ref={this.textInput}
      />
    );
  }
}
focus() {
  // ä½¿ç”¨åŸå§‹çš„ DOM API æ˜¾å¼åœ°èšç„¦åœ¨ text input ä¸Š
  // æ³¨æ„ï¼šæˆ‘ä»¬é€šè¿‡è®¿é—® â€œcurrentâ€ æ¥è·å¾— DOM èŠ‚ç‚¹
  this.textInput.current.focus();
}
```
æœ‰æ—¶ï¼Œçˆ¶ç»„ä»¶éœ€è¦æŠŠç„¦ç‚¹è®¾ç½®åœ¨å…¶å­ç»„ä»¶çš„ä¸€ä¸ªå…ƒç´ ä¸Šã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡åœ¨å­ç»„ä»¶ä¸Šè®¾ç½®ä¸€ä¸ªç‰¹æ®Šçš„ prop æ¥å¯¹çˆ¶ç»„ä»¶æš´éœ² DOM refs ä»è€ŒæŠŠçˆ¶ç»„ä»¶çš„ ref ä¼ å‘å­èŠ‚ç‚¹çš„ DOM èŠ‚ç‚¹ã€‚
å½“ä½¿ç”¨ HOC æ¥æ‰©å±•ç»„ä»¶æ—¶ï¼Œæˆ‘ä»¬å»ºè®®ä½¿ç”¨ React çš„ forwardRef å‡½æ•°æ¥å‘è¢«åŒ…è£¹çš„ç»„ä»¶[è½¬å‘ ref]ã€‚(https://react.docschina.org/docs/forwarding-refs.html)

### é¼ æ ‡å’ŒæŒ‡é’ˆäº‹ä»¶
ç¡®ä¿ä»»ä½•å¯ä»¥ä½¿ç”¨é¼ æ ‡å’ŒæŒ‡é’ˆå®Œæˆçš„åŠŸèƒ½ä¹Ÿå¯ä»¥åªé€šè¿‡é”®ç›˜å®Œæˆã€‚åªä¾é æŒ‡é’ˆä¼šäº§ç”Ÿå¾ˆå¤šä½¿é”®ç›˜ç”¨æˆ·æ— æ³•ä½¿ç”¨ä½ çš„åº”ç”¨çš„æƒ…å†µã€‚

ä¸ºäº†è¯´æ˜è¿™ä¸€ç‚¹ï¼Œè®©æˆ‘ä»¬çœ‹ä¸€ä¸‹ç”±ç‚¹å‡»äº‹ä»¶å¼•èµ·çš„ç ´åæ— éšœç¢è®¿é—®çš„å…¸å‹ç¤ºä¾‹ï¼šå¤–éƒ¨ç‚¹å‡»æ¨¡å¼ï¼Œç”¨æˆ·å¯ä»¥é€šè¿‡ç‚¹å‡»å…ƒç´ ä»¥å¤–çš„åœ°æ–¹æ¥å…³é—­å·²æ‰“å¼€çš„å¼¹å‡ºæ¡†ã€‚
é€šå¸¸å®ç°è¿™ä¸ªåŠŸèƒ½çš„æ–¹æ³•æ˜¯åœ¨ window å¯¹è±¡ä¸­é™„ä¸Šä¸€ä¸ª click äº‹ä»¶ä»¥å…³é—­å¼¹çª—ï¼š

å½“ç”¨æˆ·ä½¿ç”¨æŒ‡é’ˆè®¾å¤‡ï¼Œæ¯”å¦‚é¼ æ ‡æ—¶ï¼Œè¿™æ ·åšæ²¡æœ‰é—®é¢˜ã€‚ä½†æ˜¯å½“åªä½¿ç”¨é”®ç›˜æ—¶ï¼Œå› ä¸º window å¯¹è±¡ä¸ä¼šæ¥å—åˆ° click äº‹ä»¶ï¼Œç”¨æˆ·å°†æ— æ³•ä½¿ç”¨ tab åˆ‡æ¢åˆ°ä¸‹ä¸€ä¸ªå…ƒç´ ã€‚
è¿™æ ·ä¼šå¯¼è‡´ç”¨æˆ·æ— æ³•ä½¿ç”¨ä½ åº”ç”¨ä¸­çš„ä¸€äº›å†…å®¹ï¼Œå¯¼è‡´ä¸å®Œæ•´çš„ç”¨æˆ·ä½“éªŒã€‚
ä½¿ç”¨æ­£ç¡®çš„äº‹ä»¶è§¦å‘å™¨ï¼Œæ¯”å¦‚ onBlur å’Œ onFocusï¼ŒåŒæ ·å¯ä»¥è¾¾æˆè¿™é¡¹åŠŸèƒ½ï¼š
```javascript
class BlurExample extends React.Component {
  constructor(props) {
    super(props);

    this.state = { isOpen: false };
    this.timeOutId = null;

    this.onClickHandler = this.onClickHandler.bind(this);
    this.onBlurHandler = this.onBlurHandler.bind(this);
    this.onFocusHandler = this.onFocusHandler.bind(this);
  }

  onClickHandler() {
    this.setState(currentState => ({
      isOpen: !currentState.isOpen
    }));
  }

  // æˆ‘ä»¬åœ¨ä¸‹ä¸€ä¸ªæ—¶é—´ç‚¹ä½¿ç”¨ setTimeout å…³é—­å¼¹çª—ã€‚
  // è¿™æ˜¯å¿…è¦çš„ï¼Œå› ä¸ºå¤±å»ç„¦ç‚¹äº‹ä»¶ä¼šåœ¨æ–°çš„ç„¦ç‚¹äº‹ä»¶å‰è¢«è§¦å‘ï¼Œ
  // æˆ‘ä»¬éœ€è¦é€šè¿‡è¿™ä¸ªæ­¥éª¤ç¡®è®¤è¿™ä¸ªå…ƒç´ çš„ä¸€ä¸ªå­èŠ‚ç‚¹
  // æ˜¯å¦å¾—åˆ°äº†ç„¦ç‚¹ã€‚
  onBlurHandler() {
    this.timeOutId = setTimeout(() => {
      this.setState({
        isOpen: false
      });
    });
  }

  // å¦‚æœä¸€ä¸ªå­èŠ‚ç‚¹è·å¾—äº†ç„¦ç‚¹ï¼Œä¸è¦å…³é—­å¼¹çª—ã€‚
  onFocusHandler() {
    clearTimeout(this.timeOutId);
  }

  render() {
    // React é€šè¿‡æŠŠå¤±å»ç„¦ç‚¹å’Œè·å¾—ç„¦ç‚¹äº‹ä»¶ä¼ è¾“ç»™çˆ¶èŠ‚ç‚¹
    // æ¥å¸®åŠ©æˆ‘ä»¬ã€‚
    return (
      <div onBlur={this.onBlurHandler}
           onFocus={this.onFocusHandler}>
        <button onClick={this.onClickHandler}
                aria-haspopup="true"
                aria-expanded={this.state.isOpen}>
          Select an option
        </button>
        {this.state.isOpen && (
          <ul>
            <li>Option 1</li>
            <li>Option 2</li>
            <li>Option 3</li>
          </ul>
        )}
      </div>
    );
  }
}
```

## ä»£ç åˆ†å‰²
### React.lazy
_React.lazy å’Œ Suspense æŠ€æœ¯è¿˜ä¸æ”¯æŒæœåŠ¡ç«¯æ¸²æŸ“ã€‚å¦‚æœä½ æƒ³è¦åœ¨ä½¿ç”¨æœåŠ¡ç«¯æ¸²æŸ“çš„åº”ç”¨ä¸­ä½¿ç”¨ï¼Œæˆ‘ä»¬æ¨è [Loadable Components](https://github.com/gregberge/loadable-components) è¿™ä¸ªåº“ã€‚å®ƒæœ‰ä¸€ä¸ªå¾ˆæ£’çš„æœåŠ¡ç«¯æ¸²æŸ“æ‰“åŒ…æŒ‡å—ã€‚_
React.lazy å‡½æ•°èƒ½è®©ä½ åƒæ¸²æŸ“å¸¸è§„ç»„ä»¶ä¸€æ ·å¤„ç†åŠ¨æ€å¼•å…¥ï¼ˆçš„ç»„ä»¶ï¼‰ã€‚
ä½¿ç”¨ä¹‹å‰ï¼š
```javascript
import OtherComponent from './OtherComponent';
```
ä½¿ç”¨ä¹‹åï¼š
```javascript
const OtherComponent = React.lazy(() => import('./OtherComponent'));
```
æ­¤ä»£ç å°†ä¼šåœ¨ç»„ä»¶é¦–æ¬¡æ¸²æŸ“æ—¶ï¼Œè‡ªåŠ¨å¯¼å…¥åŒ…å« OtherComponent ç»„ä»¶çš„åŒ…ã€‚
React.lazy æ¥å—ä¸€ä¸ªå‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°éœ€è¦åŠ¨æ€è°ƒç”¨ import()ã€‚å®ƒå¿…é¡»è¿”å›ä¸€ä¸ª Promiseï¼Œè¯¥ Promise éœ€è¦ resolve ä¸€ä¸ª defalut export çš„ React ç»„ä»¶ã€‚

ç„¶ååº”åœ¨ Suspense ç»„ä»¶ä¸­æ¸²æŸ“ lazy ç»„ä»¶ï¼Œå¦‚æ­¤ä½¿å¾—æˆ‘ä»¬å¯ä»¥ä½¿ç”¨åœ¨ç­‰å¾…åŠ è½½ lazy ç»„ä»¶æ—¶åšä¼˜é›…é™çº§ï¼ˆå¦‚ loading æŒ‡ç¤ºå™¨ç­‰ï¼‰ã€‚
```javascript
import React, { Suspense } from 'react';

const OtherComponent = React.lazy(() => import('./OtherComponent'));

function MyComponent() {
  return (
    <div>
      <Suspense fallback={<div>Loading...</div>}>
        <OtherComponent />
      </Suspense>
    </div>
  );
}
```
fallback å±æ€§æ¥å—ä»»ä½•åœ¨ç»„ä»¶åŠ è½½è¿‡ç¨‹ä¸­ä½ æƒ³å±•ç¤ºçš„ React å…ƒç´ ã€‚ä½ å¯ä»¥å°† Suspense ç»„ä»¶ç½®äºæ‡’åŠ è½½ç»„ä»¶ä¹‹ä¸Šçš„ä»»ä½•ä½ç½®ã€‚ä½ ç”šè‡³å¯ä»¥ç”¨ä¸€ä¸ª Suspense ç»„ä»¶åŒ…è£¹å¤šä¸ªæ‡’åŠ è½½ç»„ä»¶ã€‚

### å¼‚å¸¸æ•è·è¾¹ç•Œï¼ˆError boundariesï¼‰
å¦‚æœæ¨¡å—åŠ è½½å¤±è´¥ï¼ˆå¦‚ç½‘ç»œé—®é¢˜ï¼‰ï¼Œå®ƒä¼šè§¦å‘ä¸€ä¸ªé”™è¯¯ã€‚ä½ å¯ä»¥é€šè¿‡[å¼‚å¸¸æ•è·è¾¹ç•Œï¼ˆError boundariesï¼‰](https://react.docschina.org/docs/error-boundaries.html)æŠ€æœ¯æ¥å¤„ç†è¿™äº›æƒ…å†µï¼Œä»¥æ˜¾ç¤ºè‰¯å¥½çš„ç”¨æˆ·ä½“éªŒå¹¶ç®¡ç†æ¢å¤äº‹å®œã€‚
### åŸºäºè·¯ç”±çš„ä»£ç åˆ†å‰²

### å‘½åå¯¼å‡ºï¼ˆNamed Exportsï¼‰
React.lazy ç›®å‰åªæ”¯æŒé»˜è®¤å¯¼å‡ºï¼ˆdefault exportsï¼‰ã€‚å¦‚æœä½ æƒ³è¢«å¼•å…¥çš„æ¨¡å—ä½¿ç”¨å‘½åå¯¼å‡ºï¼ˆnamed exportsï¼‰ï¼Œä½ å¯ä»¥åˆ›å»ºä¸€ä¸ªä¸­é—´æ¨¡å—ï¼Œæ¥é‡æ–°å¯¼å‡ºä¸ºé»˜è®¤æ¨¡å—ã€‚è¿™èƒ½ä¿è¯ tree shaking ä¸ä¼šå‡ºé”™ï¼Œå¹¶ä¸”ä¸å¿…å¼•å…¥ä¸éœ€è¦çš„ç»„ä»¶ã€‚
```javascript
// ManyComponents.js
export const MyComponent = /* ... */;
export const MyUnusedComponent = /* ... */;
```
```javascript
// MyComponent.js
export { MyComponent as default } from "./ManyComponents.js";
```
```javascript
// MyApp.js
import React, { lazy } from 'react';
const MyComponent = lazy(() => import("./MyComponent.js"));
```
## Context
Context è®¾è®¡ç›®çš„æ˜¯ä¸ºäº†å…±äº«é‚£äº›å¯¹äºä¸€ä¸ªç»„ä»¶æ ‘è€Œè¨€æ˜¯â€œå…¨å±€â€çš„æ•°æ®ã€‚
ä½¿ç”¨ context, æˆ‘ä»¬å¯ä»¥é¿å…é€šè¿‡ä¸­é—´å…ƒç´ ä¼ é€’ propsï¼š
```javascript
// Context å¯ä»¥è®©æˆ‘ä»¬æ— é¡»æ˜ç¡®åœ°ä¼ éæ¯ä¸€ä¸ªç»„ä»¶ï¼Œå°±èƒ½å°†å€¼æ·±å…¥ä¼ é€’è¿›ç»„ä»¶æ ‘ã€‚
// ä¸ºå½“å‰çš„ theme åˆ›å»ºä¸€ä¸ª contextï¼ˆâ€œlightâ€ä¸ºé»˜è®¤å€¼ï¼‰ã€‚
const ThemeContext = React.createContext('light');
class App extends React.Component {
  render() {
    // ä½¿ç”¨ä¸€ä¸ª Provider æ¥å°†å½“å‰çš„ theme ä¼ é€’ç»™ä»¥ä¸‹çš„ç»„ä»¶æ ‘ã€‚
    // æ— è®ºå¤šæ·±ï¼Œä»»ä½•ç»„ä»¶éƒ½èƒ½è¯»å–è¿™ä¸ªå€¼ã€‚
    // åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å°† â€œdarkâ€ ä½œä¸ºå½“å‰çš„å€¼ä¼ é€’ä¸‹å»ã€‚
    return (
      <ThemeContext.Provider value="dark">
        <Toolbar />
      </ThemeContext.Provider>
    );
  }
}

// ä¸­é—´çš„ç»„ä»¶å†ä¹Ÿä¸å¿…æŒ‡æ˜å¾€ä¸‹ä¼ é€’ theme äº†ã€‚
function Toolbar() {
  return (
    <div>
      <ThemedButton />
    </div>
  );
}

class ThemedButton extends React.Component {
  // æŒ‡å®š contextType è¯»å–å½“å‰çš„ theme contextã€‚
  // React ä¼šå¾€ä¸Šæ‰¾åˆ°æœ€è¿‘çš„ theme Providerï¼Œç„¶åä½¿ç”¨å®ƒçš„å€¼ã€‚
  // åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œå½“å‰çš„ theme å€¼ä¸º â€œdarkâ€ã€‚
  static contextType = ThemeContext;
  render() {
    return <Button theme={this.context} />;
  }
}
```
### ä½¿ç”¨ Context ä¹‹å‰çš„è€ƒè™‘
Context ä¸»è¦åº”ç”¨åœºæ™¯åœ¨äºå¾ˆå¤šä¸åŒå±‚çº§çš„ç»„ä»¶éœ€è¦è®¿é—®åŒæ ·ä¸€äº›çš„æ•°æ®ã€‚è¯·è°¨æ…ä½¿ç”¨ï¼Œå› ä¸ºè¿™ä¼šä½¿å¾—ç»„ä»¶çš„å¤ç”¨æ€§å˜å·®ã€‚

å¦‚æœä½ åªæ˜¯æƒ³é¿å…å±‚å±‚ä¼ é€’ä¸€äº›å±æ€§ï¼Œ[ç»„ä»¶ç»„åˆï¼ˆcomponent compositionï¼‰](https://react.docschina.org/docs/composition-vs-inheritance.html)æœ‰æ—¶å€™æ˜¯ä¸€ä¸ªæ¯” context æ›´å¥½çš„è§£å†³æ–¹æ¡ˆã€‚
ä¸€ç§æ— éœ€ context çš„è§£å†³æ–¹æ¡ˆæ˜¯å°†å­ç»„ä»¶è‡ªèº«ä¼ é€’ä¸‹å»ï¼Œå› è€Œä¸­é—´ç»„ä»¶æ— éœ€çŸ¥é“ä¸€äº›åªæœ‰å­ç»„ä»¶éœ€è¦çš„props

### API
https://react.docschina.org/docs/context.html#api
- React.createContext
- Context.Provider
- Class.contextType
- Context.Consumer
- Context.displayName

## é”™è¯¯è¾¹ç•Œ
é”™è¯¯è¾¹ç•Œæ˜¯ä¸€ç§ React ç»„ä»¶ï¼Œè¿™ç§ç»„ä»¶å¯ä»¥æ•è·å¹¶æ‰“å°å‘ç”Ÿåœ¨å…¶å­ç»„ä»¶æ ‘ä»»ä½•ä½ç½®çš„ JavaScript é”™è¯¯ï¼Œå¹¶ä¸”ï¼Œå®ƒä¼šæ¸²æŸ“å‡ºå¤‡ç”¨ UIï¼Œè€Œä¸æ˜¯æ¸²æŸ“é‚£äº›å´©æºƒäº†çš„å­ç»„ä»¶æ ‘ã€‚
é”™è¯¯è¾¹ç•Œåœ¨æ¸²æŸ“æœŸé—´ã€ç”Ÿå‘½å‘¨æœŸæ–¹æ³•å’Œæ•´ä¸ªç»„ä»¶æ ‘çš„æ„é€ å‡½æ•°ä¸­æ•è·é”™è¯¯ã€‚
å¦‚æœä¸€ä¸ª class ç»„ä»¶ä¸­å®šä¹‰äº† static getDerivedStateFromError() æˆ– componentDidCatch() è¿™ä¸¤ä¸ªç”Ÿå‘½å‘¨æœŸæ–¹æ³•ä¸­çš„ä»»æ„ä¸€ä¸ªï¼ˆæˆ–ä¸¤ä¸ªï¼‰æ—¶ï¼Œé‚£ä¹ˆå®ƒå°±å˜æˆä¸€ä¸ªé”™è¯¯è¾¹ç•Œã€‚
åªæœ‰ class ç»„ä»¶æ‰å¯ä»¥æˆä¸ºé”™è¯¯è¾¹ç•Œç»„ä»¶ã€‚
é”™è¯¯è¾¹ç•Œä»…å¯ä»¥æ•è·å…¶å­ç»„ä»¶çš„é”™è¯¯ï¼Œå®ƒæ— æ³•æ•è·å…¶è‡ªèº«çš„é”™è¯¯ã€‚å¦‚æœä¸€ä¸ªé”™è¯¯è¾¹ç•Œæ— æ³•æ¸²æŸ“é”™è¯¯ä¿¡æ¯ï¼Œåˆ™é”™è¯¯ä¼šå†’æ³¡è‡³æœ€è¿‘çš„ä¸Šå±‚é”™è¯¯è¾¹ç•Œ

é”™è¯¯è¾¹ç•Œæ— æ³•æ•è·ä»¥ä¸‹åœºæ™¯ä¸­äº§ç”Ÿçš„é”™è¯¯ï¼š

- äº‹ä»¶å¤„ç†[ï¼ˆäº†è§£æ›´å¤šï¼‰](https://react.docschina.org/docs/error-boundaries.html#how-about-event-handlers)
  å¦‚æœä½ éœ€è¦åœ¨äº‹ä»¶å¤„ç†å™¨å†…éƒ¨æ•è·é”™è¯¯ï¼Œä½¿ç”¨æ™®é€šçš„ JavaScript try / catch è¯­å¥
- å¼‚æ­¥ä»£ç ï¼ˆä¾‹å¦‚ setTimeout æˆ– requestAnimationFrame å›è°ƒå‡½æ•°ï¼‰
- æœåŠ¡ç«¯æ¸²æŸ“
- å®ƒè‡ªèº«æŠ›å‡ºæ¥çš„é”™è¯¯ï¼ˆå¹¶éå®ƒçš„å­ç»„ä»¶ï¼‰

- getDerivedStateFromError
æ­¤ç”Ÿå‘½å‘¨æœŸä¼šåœ¨åä»£ç»„ä»¶æŠ›å‡ºé”™è¯¯åè¢«è°ƒç”¨ã€‚ å®ƒå°†æŠ›å‡ºçš„é”™è¯¯ä½œä¸ºå‚æ•°ï¼Œå¹¶è¿”å›ä¸€ä¸ªå€¼ä»¥æ›´æ–° state
- componentDidCatch
æ­¤ç”Ÿå‘½å‘¨æœŸåœ¨åä»£ç»„ä»¶æŠ›å‡ºé”™è¯¯åè¢«è°ƒç”¨ã€‚

### ç»„ä»¶æ ˆè¿½è¸ª
åœ¨ç»„ä»¶æ ˆè¿½è¸ªä¸­æŸ¥çœ‹æ–‡ä»¶åå’Œè¡Œå·ï¼Œè¿™ä¸€åŠŸèƒ½åœ¨ Create React App é¡¹ç›®ä¸­é»˜è®¤å¼€å¯ã€‚
å¦‚æœä½ æ²¡æœ‰ä½¿ç”¨ Create React Appï¼Œå¯ä»¥æ‰‹åŠ¨å°†[è¯¥æ’ä»¶](https://www.npmjs.com/package/babel-plugin-transform-react-jsx-source)æ·»åŠ åˆ°ä½ çš„ Babel é…ç½®ä¸­ã€‚æ³¨æ„å®ƒä»…ç”¨äºå¼€å‘ç¯å¢ƒï¼Œåœ¨ç”Ÿäº§ç¯å¢ƒå¿…é¡»å°†å…¶ç¦ç”¨ ã€‚
æ³¨æ„ï¼šç»„ä»¶åç§°åœ¨æ ˆè¿½è¸ªä¸­çš„æ˜¾ç¤ºä¾èµ–äº Function.name å±æ€§ã€‚å¦‚æœä½ æƒ³è¦æ”¯æŒå°šæœªæä¾›è¯¥åŠŸèƒ½çš„æ—§ç‰ˆæµè§ˆå™¨å’Œè®¾å¤‡ï¼ˆä¾‹å¦‚ IE 11ï¼‰ï¼Œè€ƒè™‘åœ¨ä½ çš„æ‰“åŒ…ï¼ˆbundledï¼‰åº”ç”¨ç¨‹åºä¸­åŒ…å«ä¸€ä¸ª [Function.name](https://github.com/JamesMGreene/Function.name) çš„ polyfill ã€‚æˆ–è€…ï¼Œä½ å¯ä»¥åœ¨æ‰€æœ‰ç»„ä»¶ä¸Šæ˜¾å¼è®¾ç½® displayName å±æ€§ã€‚

## refè½¬å‘
ref åªåœ¨ä½¿ç”¨ React.forwardRef å®šä¹‰ç»„ä»¶æ—¶å­˜åœ¨ã€‚å¸¸è§„å‡½æ•°å’Œ class ç»„ä»¶ä¸æ¥æ”¶ ref å‚æ•°ï¼Œä¸” props ä¸­ä¹Ÿä¸å­˜åœ¨ refã€‚
```javascript
const FancyButton = React.forwardRef((props, ref) => (
  <button ref={ref} className="FancyButton">
    {props.children}
  </button>
));

// ä½ å¯ä»¥ç›´æ¥è·å– DOM button çš„ refï¼š
const ref = React.createRef();
<FancyButton ref={ref}>Click me!</FancyButton>;
```
### é«˜é˜¶ç»„ä»¶ä¸­è½¬å‘ refs
```javascript
function logProps(WrappedComponent) {
  class LogProps extends React.Component {
    componentDidUpdate(prevProps) {
      console.log('old props:', prevProps);
      console.log('new props:', this.props);
    }

    render() {
      return <WrappedComponent {...this.props} />;
    }
  }

  return LogProps;
}

class FancyButton extends React.Component {
  focus() {
    // ...
  }
  // ...
}

// æˆ‘ä»¬å¯¼å‡º LogPropsï¼Œè€Œä¸æ˜¯ FancyButtonã€‚
// è™½ç„¶å®ƒä¹Ÿä¼šæ¸²æŸ“ä¸€ä¸ª FancyButtonã€‚
export default logProps(FancyButton);

import FancyButton from './FancyButton';

const ref = React.createRef();

// æˆ‘ä»¬å¯¼å…¥çš„ FancyButton ç»„ä»¶æ˜¯é«˜é˜¶ç»„ä»¶ï¼ˆHOCï¼‰LogPropsã€‚
// å°½ç®¡æ¸²æŸ“ç»“æœå°†æ˜¯ä¸€æ ·çš„ï¼Œ
// ä½†æˆ‘ä»¬çš„ ref å°†æŒ‡å‘ LogProps è€Œä¸æ˜¯å†…éƒ¨çš„ FancyButton ç»„ä»¶ï¼
// è¿™æ„å‘³ç€æˆ‘ä»¬ä¸èƒ½è°ƒç”¨ä¾‹å¦‚ ref.current.focus() è¿™æ ·çš„æ–¹æ³•
<FancyButton
        label="Click Me"
        handleClick={handleClick}
        ref={ref}
/>;
```
ä¸Šé¢çš„ç¤ºä¾‹æœ‰ä¸€ç‚¹éœ€è¦æ³¨æ„ï¼šrefs å°†ä¸ä¼šé€ä¼ ä¸‹å»ã€‚è¿™æ˜¯å› ä¸º ref ä¸æ˜¯ prop å±æ€§ã€‚å°±åƒ key ä¸€æ ·ï¼Œå…¶è¢« React è¿›è¡Œäº†ç‰¹æ®Šå¤„ç†ã€‚å¦‚æœä½ å¯¹ HOC æ·»åŠ  refï¼Œè¯¥ ref å°†å¼•ç”¨**æœ€å¤–å±‚**çš„å®¹å™¨ç»„ä»¶ï¼Œè€Œä¸æ˜¯è¢«åŒ…è£¹çš„ç»„ä»¶ã€‚

å¯ä»¥ä½¿ç”¨ React.forwardRef API æ˜ç¡®åœ°å°† refs è½¬å‘åˆ°å†…éƒ¨çš„ FancyButton ç»„ä»¶ã€‚
```javascript
function logProps(Component) {
  class LogProps extends React.Component {
    componentDidUpdate(prevProps) {
      console.log('old props:', prevProps);
      console.log('new props:', this.props);
    }

    render() {
      const {forwardedRef, ...rest} = this.props;

      // å°†è‡ªå®šä¹‰çš„ prop å±æ€§ â€œforwardedRefâ€ å®šä¹‰ä¸º ref
      return <Component ref={forwardedRef} {...rest} />;
    }
  }

  // æ³¨æ„ React.forwardRef å›è°ƒçš„ç¬¬äºŒä¸ªå‚æ•° â€œrefâ€ã€‚
  // æˆ‘ä»¬å¯ä»¥å°†å…¶ä½œä¸ºå¸¸è§„ prop å±æ€§ä¼ é€’ç»™ LogPropsï¼Œä¾‹å¦‚ â€œforwardedRefâ€
  // ç„¶åå®ƒå°±å¯ä»¥è¢«æŒ‚è½½åˆ°è¢« LogProps åŒ…è£¹çš„å­ç»„ä»¶ä¸Šã€‚
  return React.forwardRef((props, ref) => {
    return <LogProps {...props} forwardedRef={ref} />;
  });
}
```

### åœ¨ DevTools ä¸­æ˜¾ç¤ºè‡ªå®šä¹‰åç§°
https://react.docschina.org/docs/forwarding-refs.html#displaying-a-custom-name-in-devtools

## Fragments
key æ˜¯å”¯ä¸€å¯ä»¥ä¼ é€’ç»™ Fragment çš„å±æ€§ã€‚
```javascript
render() {
  return (
    <React.Fragment>
      <ChildA />
      <ChildB />
      <ChildC />
    </React.Fragment>
  );
}

// æˆ–çŸ­è¯­æ³•
render() {
  return (
          <>
            <ChildA />
            <ChildB />
            <ChildC />
          </>
  );
}
```
## é«˜é˜¶ç»„ä»¶
é«˜é˜¶ç»„ä»¶æ˜¯å‚æ•°ä¸ºç»„ä»¶ï¼Œè¿”å›å€¼ä¸ºæ–°ç»„ä»¶çš„å‡½æ•°ã€‚HOC æ˜¯çº¯å‡½æ•°ï¼Œæ²¡æœ‰å‰¯ä½œç”¨ã€‚
HOCå’ŒåŒ…è£…ç»„ä»¶ä¹‹é—´çš„å¥‘çº¦å®Œå…¨åŸºäºä¹‹é—´ä¼ é€’çš„ propsã€‚è¿™ç§ä¾èµ–æ–¹å¼ä½¿å¾—æ›¿æ¢ HOC å˜å¾—å®¹æ˜“ï¼Œåªè¦å®ƒä»¬ä¸ºåŒ…è£…çš„ç»„ä»¶æä¾›ç›¸åŒçš„ prop å³å¯ã€‚ä¾‹å¦‚ä½ éœ€è¦æ”¹ç”¨å…¶ä»–åº“æ¥è·å–æ•°æ®çš„æ—¶å€™ï¼Œè¿™ä¸€ç‚¹å°±å¾ˆæœ‰ç”¨ã€‚
```javascript
const CommentListWithSubscription = withSubscription(
  CommentList,
  (DataSource) => DataSource.getComments()
);

const BlogPostWithSubscription = withSubscription(
  BlogPost,
  (DataSource, props) => DataSource.getBlogPost(props.id)
);

// æ­¤å‡½æ•°æ¥æ”¶ä¸€ä¸ªç»„ä»¶...
function withSubscription(WrappedComponent, selectData) {
  // ...å¹¶è¿”å›å¦ä¸€ä¸ªç»„ä»¶...
  return class extends React.Component {
    constructor(props) {
      super(props);
      this.handleChange = this.handleChange.bind(this);
      this.state = {
        data: selectData(DataSource, props)
      };
    }

    componentDidMount() {
      // ...è´Ÿè´£è®¢é˜…ç›¸å…³çš„æ“ä½œ...
      DataSource.addChangeListener(this.handleChange);
    }

    componentWillUnmount() {
      DataSource.removeChangeListener(this.handleChange);
    }

    handleChange() {
      this.setState({
        data: selectData(DataSource, this.props)
      });
    }

    render() {
      // ... å¹¶ä½¿ç”¨æ–°æ•°æ®æ¸²æŸ“è¢«åŒ…è£…çš„ç»„ä»¶!
      // è¯·æ³¨æ„ï¼Œæˆ‘ä»¬å¯èƒ½è¿˜ä¼šä¼ é€’å…¶ä»–å±æ€§
      return <WrappedComponent data={this.state.data} {...this.props} />;
    }
  };
}
```
### çº¦å®šï¼šå°†ä¸ç›¸å…³çš„ props ä¼ é€’ç»™è¢«åŒ…è£¹çš„ç»„ä»¶
HOC è¿”å›çš„ç»„ä»¶ä¸åŸç»„ä»¶åº”ä¿æŒç±»ä¼¼çš„æ¥å£ã€‚

HOC åº”è¯¥é€ä¼ ä¸è‡ªèº«æ— å…³çš„ propsã€‚å¤§å¤šæ•° HOC éƒ½åº”è¯¥åŒ…å«ä¸€ä¸ªç±»ä¼¼äºä¸‹é¢çš„ render æ–¹æ³•ï¼š
```javascript
render() {
  // è¿‡æ»¤æ‰éæ­¤ HOC é¢å¤–çš„ propsï¼Œä¸”ä¸è¦è¿›è¡Œé€ä¼ 
  const { extraProp, ...passThroughProps } = this.props;

  // å°† props æ³¨å…¥åˆ°è¢«åŒ…è£…çš„ç»„ä»¶ä¸­ã€‚
  // é€šå¸¸ä¸º state çš„å€¼æˆ–è€…å®ä¾‹æ–¹æ³•ã€‚
  const injectedProp = someStateOrInstanceMethod;

  // å°† props ä¼ é€’ç»™è¢«åŒ…è£…ç»„ä»¶
  return (
    <WrappedComponent
      injectedProp={injectedProp}
      {...passThroughProps}
    />
  );
}
```
### çº¦å®šï¼šæœ€å¤§åŒ–å¯ç»„åˆæ€§
ä¸€ä¸ªå‡½æ•°åªåšä¸€ä»¶äº‹ã€‚ åƒ connect å‡½æ•°è¿”å›çš„å•å‚æ•° HOC å…·æœ‰ç­¾å Component => Componentã€‚ è¾“å‡ºç±»å‹ä¸è¾“å…¥ç±»å‹ç›¸åŒçš„å‡½æ•°å¾ˆå®¹æ˜“ç»„åˆåœ¨ä¸€èµ·ã€‚
### çº¦å®šï¼šåŒ…è£…æ˜¾ç¤ºåç§°ä»¥ä¾¿è½»æ¾è°ƒè¯•
https://react.docschina.org/docs/higher-order-components.html#convention-wrap-the-display-name-for-easy-debugging
### ä¸è¦åœ¨ render æ–¹æ³•ä¸­ä½¿ç”¨ HOC
å¦‚æœä» render è¿”å›çš„ç»„ä»¶ä¸å‰ä¸€ä¸ªæ¸²æŸ“ä¸­çš„ç»„ä»¶ç›¸åŒï¼ˆ===ï¼‰ï¼Œåˆ™ React é€šè¿‡å°†å­æ ‘ä¸æ–°å­æ ‘è¿›è¡ŒåŒºåˆ†æ¥é€’å½’æ›´æ–°å­æ ‘ã€‚ å¦‚æœå®ƒä»¬ä¸ç›¸ç­‰ï¼Œåˆ™å®Œå…¨å¸è½½å‰ä¸€ä¸ªå­æ ‘ã€‚
è€Œåœ¨renderå‡½æ•°ä¸­ä½¿ç”¨HOCï¼Œæ¯æ¬¡éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°ç»„ä»¶ï¼Œæ‰€ä»¥è¦åœ¨ç»„ä»¶ä¹‹å¤–åˆ›å»º HOCï¼Œè¿™æ ·ä¸€æ¥ç»„ä»¶åªä¼šåˆ›å»ºä¸€æ¬¡ã€‚
### åŠ¡å¿…å¤åˆ¶é™æ€æ–¹æ³•åˆ°è¿”å›çš„æ–°ç»„ä»¶
ä½ å¯ä»¥ä½¿ç”¨ [hoist-non-react-statics](https://github.com/mridgway/hoist-non-react-statics) è‡ªåŠ¨æ‹·è´æ‰€æœ‰é React é™æ€æ–¹æ³•:
## Portals
Portal æä¾›äº†ä¸€ç§å°†å­èŠ‚ç‚¹æ¸²æŸ“åˆ°å­˜åœ¨äºçˆ¶ç»„ä»¶ä»¥å¤–çš„ DOM èŠ‚ç‚¹çš„ä¼˜ç§€çš„æ–¹æ¡ˆã€‚
ReactDOM.createPortal(childå¯æ¸²æŸ“çš„ React å­å…ƒç´ , containerDOM å…ƒç´ )

æ³¨æ„ï¼š
å½“åœ¨ä½¿ç”¨ portal æ—¶, è®°ä½[ç®¡ç†é”®ç›˜ç„¦ç‚¹](https://react.docschina.org/docs/accessibility.html#programmatically-managing-focus)å°±å˜å¾—å°¤ä¸ºé‡è¦ã€‚

å¯¹äºæ¨¡æ€å¯¹è¯æ¡†ï¼Œé€šè¿‡éµå¾ª [WAI-ARIA æ¨¡æ€å¼€å‘å®è·µ](https://www.w3.org/TR/wai-aria-practices-1.1/#dialog_modal)ï¼Œæ¥ç¡®ä¿æ¯ä¸ªäººéƒ½èƒ½å¤Ÿè¿ç”¨å®ƒã€‚
### é€šè¿‡ Portal è¿›è¡Œäº‹ä»¶å†’æ³¡
ä¸€ä¸ªä» portal å†…éƒ¨è§¦å‘çš„äº‹ä»¶ä¼šä¸€ç›´å†’æ³¡è‡³åŒ…å« React æ ‘çš„ç¥–å…ˆï¼Œå³ä¾¿è¿™äº›å…ƒç´ å¹¶ä¸æ˜¯ DOM æ ‘ ä¸­çš„ç¥–å…ˆã€‚
## Profiler API
https://react.docschina.org/docs/profiler.html
## Refs
### ä½•æ—¶ä½¿ç”¨ Refs
é¿å…ä½¿ç”¨ refs æ¥åšä»»ä½•å¯ä»¥é€šè¿‡å£°æ˜å¼å®ç°æ¥å®Œæˆçš„äº‹æƒ…ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œé¿å…åœ¨ Dialog ç»„ä»¶é‡Œæš´éœ² open() å’Œ close() æ–¹æ³•ï¼Œæœ€å¥½ä¼ é€’ isOpen å±æ€§ã€‚
### å‹¿è¿‡åº¦ä½¿ç”¨ Refs
### Refsçš„åˆ›å»º
Refs æ˜¯ä½¿ç”¨ React.createRef() åˆ›å»ºçš„ï¼Œå¹¶é€šè¿‡ ref å±æ€§é™„åŠ åˆ° React å…ƒç´ ã€‚
### è®¿é—® Refs
å½“ ref è¢«ä¼ é€’ç»™ render ä¸­çš„å…ƒç´ æ—¶ï¼Œå¯¹è¯¥èŠ‚ç‚¹çš„å¼•ç”¨å¯ä»¥åœ¨ ref çš„ current å±æ€§ä¸­è¢«è®¿é—®ã€‚
ref ä¼šåœ¨ componentDidMount æˆ– componentDidUpdate ç”Ÿå‘½å‘¨æœŸé’©å­è§¦å‘å‰æ›´æ–°ã€‚

ref çš„å€¼æ ¹æ®èŠ‚ç‚¹çš„ç±»å‹è€Œæœ‰æ‰€ä¸åŒï¼š
- å½“ ref å±æ€§ç”¨äº HTML å…ƒç´ æ—¶ï¼Œæ„é€ å‡½æ•°ä¸­ä½¿ç”¨ React.createRef() åˆ›å»ºçš„ ref æ¥æ”¶åº•å±‚ DOM å…ƒç´ ä½œä¸ºå…¶ current å±æ€§ã€‚
- å½“ ref å±æ€§ç”¨äºè‡ªå®šä¹‰ class ç»„ä»¶æ—¶ï¼Œref å¯¹è±¡æ¥æ”¶ç»„ä»¶çš„æŒ‚è½½å®ä¾‹ä½œä¸ºå…¶ current å±æ€§ã€‚
- ä½ ä¸èƒ½åœ¨å‡½æ•°ç»„ä»¶ä¸Šä½¿ç”¨ ref å±æ€§ï¼Œå› ä¸ºä»–ä»¬æ²¡æœ‰å®ä¾‹ã€‚
  å¦‚æœè¦åœ¨å‡½æ•°ç»„ä»¶ä¸­ä½¿ç”¨ refï¼Œä½ å¯ä»¥ä½¿ç”¨ [forwardRef](https://react.docschina.org/docs/forwarding-refs.html)ï¼ˆå¯ä¸ [useImperativeHandle](https://react.docschina.org/docs/hooks-reference.html#useimperativehandle) ç»“åˆä½¿ç”¨ï¼‰

å‡½æ•°ç»„ä»¶å†…éƒ¨ä½¿ç”¨ ref å±æ€§
```javascript
function CustomTextInput(props) {
  // è¿™é‡Œå¿…é¡»å£°æ˜ textInputï¼Œè¿™æ · ref æ‰å¯ä»¥å¼•ç”¨å®ƒ
  const textInput = useRef(null);

  function handleClick() {
    textInput.current.focus();
  }

  return (
    <div>
      <input
        type="text"
        ref={textInput} />
      <input
        type="button"
        value="Focus the text input"
        onClick={handleClick}
      />
    </div>
  );
}

```
### å°† DOM Refs æš´éœ²ç»™çˆ¶ç»„ä»¶
- [å‘å­ç»„ä»¶æ·»åŠ  ref](https://react.docschina.org/docs/refs-and-the-dom.html#adding-a-ref-to-a-class-component)ã€‚ä½†è¿™ä¸æ˜¯ä¸€ä¸ªç†æƒ³çš„è§£å†³æ–¹æ¡ˆï¼Œå› ä¸ºä½ åªèƒ½è·å–ç»„ä»¶å®ä¾‹è€Œä¸æ˜¯ DOM èŠ‚ç‚¹ã€‚å¹¶ä¸”ï¼Œå®ƒè¿˜åœ¨å‡½æ•°ç»„ä»¶ä¸Šæ— æ•ˆã€‚
- [refè½¬å‘](https://react.docschina.org/docs/forwarding-refs.html)
- [ref ä½œä¸ºç‰¹æ®Šåå­—çš„ prop ç›´æ¥ä¼ é€’](https://gist.github.com/gaearon/1a018a023347fe1c2476073330cc5509)
å¯èƒ½çš„è¯ï¼Œæˆ‘ä»¬ä¸å»ºè®®æš´éœ² DOM èŠ‚ç‚¹ï¼Œä½†æœ‰æ—¶å€™å®ƒä¼šæˆä¸ºæ•‘å‘½ç¨»è‰ã€‚æ³¨æ„è¿™ä¸ªæ–¹æ¡ˆéœ€è¦ä½ åœ¨å­ç»„ä»¶ä¸­å¢åŠ ä¸€äº›ä»£ç ã€‚
å¦‚æœä½ å¯¹å­ç»„ä»¶çš„å®ç°æ²¡æœ‰æ§åˆ¶æƒçš„è¯ï¼Œä½ å‰©ä¸‹çš„é€‰æ‹©æ˜¯ä½¿ç”¨ findDOMNode()ï¼Œä½†åœ¨ä¸¥æ ¼æ¨¡å¼ ä¸‹å·²è¢«åºŸå¼ƒä¸”ä¸æ¨èä½¿ç”¨ã€‚

### å›è°ƒ Refs
ä¸åŒäºä¼ é€’ createRef() åˆ›å»ºçš„ ref å±æ€§ï¼Œä½ ä¼šä¼ é€’ä¸€ä¸ªå‡½æ•°ã€‚è¿™ä¸ªå‡½æ•°ä¸­æ¥å— React ç»„ä»¶å®ä¾‹æˆ– HTML DOM å…ƒç´ ä½œä¸ºå‚æ•°ï¼Œä»¥ä½¿å®ƒä»¬èƒ½åœ¨å…¶ä»–åœ°æ–¹è¢«å­˜å‚¨å’Œè®¿é—®ã€‚
React å°†åœ¨ç»„ä»¶æŒ‚è½½æ—¶ï¼Œä¼šè°ƒç”¨ ref å›è°ƒå‡½æ•°å¹¶ä¼ å…¥ DOM å…ƒç´ ï¼Œå½“å¸è½½æ—¶è°ƒç”¨å®ƒå¹¶ä¼ å…¥ nullã€‚åœ¨ componentDidMount æˆ– componentDidUpdate è§¦å‘å‰ï¼ŒReact ä¼šä¿è¯ refs ä¸€å®šæ˜¯æœ€æ–°çš„ã€‚

ä¸‹é¢çš„ä¾‹å­æè¿°äº†ä¸€ä¸ªé€šç”¨çš„èŒƒä¾‹ï¼šä½¿ç”¨ ref å›è°ƒå‡½æ•°ï¼Œåœ¨å®ä¾‹çš„å±æ€§ä¸­å­˜å‚¨å¯¹ DOM èŠ‚ç‚¹çš„å¼•ç”¨ã€‚
```javascript
class CustomTextInput extends React.Component {
  constructor(props) {
    super(props);

    this.textInput = null;

    this.setTextInputRef = element => {
      this.textInput = element;
    };

    this.focusTextInput = () => {
      // ä½¿ç”¨åŸç”Ÿ DOM API ä½¿ text è¾“å…¥æ¡†è·å¾—ç„¦ç‚¹
      if (this.textInput) this.textInput.focus();
    };
  }

  componentDidMount() {
    // ç»„ä»¶æŒ‚è½½åï¼Œè®©æ–‡æœ¬æ¡†è‡ªåŠ¨è·å¾—ç„¦ç‚¹
    this.focusTextInput();
  }

  render() {
    // ä½¿ç”¨ `ref` çš„å›è°ƒå‡½æ•°å°† text è¾“å…¥æ¡† DOM èŠ‚ç‚¹çš„å¼•ç”¨å­˜å‚¨åˆ° React
    // å®ä¾‹ä¸Šï¼ˆæ¯”å¦‚ this.textInputï¼‰
    return (
      <div>
        <input
          type="text"
          ref={this.setTextInputRef}
        />
        <input
          type="button"
          value="Focus the text input"
          onClick={this.focusTextInput}
        />
      </div>
    );
  }
}
```
ä½ å¯ä»¥åœ¨ç»„ä»¶é—´ä¼ é€’å›è°ƒå½¢å¼çš„ refsï¼Œå°±åƒä½ å¯ä»¥ä¼ é€’é€šè¿‡ React.createRef() åˆ›å»ºçš„å¯¹è±¡ refs ä¸€æ ·ã€‚
```javascript
function CustomTextInput(props) {
  return (
    <div>
      <input ref={props.inputRef} />
    </div>
  );
}

class Parent extends React.Component {
  render() {
    // åœ¨ Parent ä¸­çš„ this.inputElement ä¼šè¢«è®¾ç½®ä¸ºä¸ CustomTextInput ä¸­çš„ input å…ƒç´ ç›¸å¯¹åº”çš„ DOM èŠ‚ç‚¹ã€‚
    return (
      <CustomTextInput
        inputRef={el => this.inputElement = el}
      />
    );
  }
}
```
å…³äºå›è°ƒ refs çš„è¯´æ˜
å¦‚æœ ref å›è°ƒå‡½æ•°æ˜¯ä»¥å†…è”å‡½æ•°çš„æ–¹å¼å®šä¹‰çš„ï¼Œåœ¨æ›´æ–°è¿‡ç¨‹ä¸­å®ƒä¼šè¢«æ‰§è¡Œä¸¤æ¬¡ï¼Œç¬¬ä¸€æ¬¡ä¼ å…¥å‚æ•° nullï¼Œç„¶åç¬¬äºŒæ¬¡ä¼šä¼ å…¥å‚æ•° DOM å…ƒç´ ã€‚
è¿™æ˜¯å› ä¸ºåœ¨æ¯æ¬¡æ¸²æŸ“æ—¶ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„å‡½æ•°å®ä¾‹ï¼Œæ‰€ä»¥ React æ¸…ç©ºæ—§çš„ ref å¹¶ä¸”è®¾ç½®æ–°çš„ã€‚é€šè¿‡å°† ref çš„å›è°ƒå‡½æ•°å®šä¹‰æˆ class çš„ç»‘å®šå‡½æ•°çš„æ–¹å¼å¯ä»¥é¿å…ä¸Šè¿°é—®é¢˜ï¼Œä½†æ˜¯å¤§å¤šæ•°æƒ…å†µä¸‹å®ƒæ˜¯æ— å…³ç´§è¦çš„ã€‚
### è¿‡æ—¶ APIï¼šString ç±»å‹çš„ Refs
https://react.docschina.org/docs/refs-and-the-dom.html#legacy-api-string-refs
## Render Props
è¯¦ç»†é˜…è¯»https://react.docschina.org/docs/render-props.html
â€œrender propâ€ æ˜¯æŒ‡ä¸€ç§åœ¨ React ç»„ä»¶ä¹‹é—´ä½¿ç”¨ä¸€ä¸ªå€¼ä¸ºå‡½æ•°çš„ prop å…±äº«ä»£ç çš„ç®€å•æŠ€æœ¯ã€‚
å…·æœ‰ render prop çš„ç»„ä»¶æ¥å—ä¸€ä¸ªå‡½æ•°ï¼Œè¯¥å‡½æ•°è¿”å›ä¸€ä¸ª React å…ƒç´ å¹¶è°ƒç”¨å®ƒè€Œä¸æ˜¯å®ç°è‡ªå·±çš„æ¸²æŸ“é€»è¾‘ã€‚
```javascript
<DataProvider render={data => (
  <h1>Hello {data.target}</h1>
)}/>
```
## typescriptå’Œflowçš„é›†æˆ
https://react.docschina.org/docs/static-type-checking.html
## ä¸¥æ ¼æ¨¡å¼
https://react.docschina.org/docs/strict-mode.html
## prop-typeé›†æˆ
https://react.docschina.org/docs/typechecking-with-proptypes.html
## Web Components
https://react.docschina.org/docs/web-components.html
## Hook
- åªåœ¨ React å‡½æ•°ï¼ˆå‡½æ•°ç»„ä»¶å’Œè‡ªå®šä¹‰ Hookï¼‰ä¸­è°ƒç”¨ Hookï¼Œä¸è¦åœ¨æ™®é€šçš„ JavaScript å‡½æ•°ä¸­è°ƒç”¨ Hookã€‚
- åªåœ¨æœ€é¡¶å±‚ä½¿ç”¨ Hook

### State Hook
å‚æ•°ï¼šå”¯ä¸€çš„å‚æ•°å°±æ˜¯åˆå§‹ state
è¿”å›å€¼ï¼šå½“å‰çŠ¶æ€å’Œä¸€ä¸ªè®©ä½ æ›´æ–°å®ƒçš„å‡½æ•°ï¼Œç±»ä¼¼ class ç»„ä»¶çš„ this.setStateï¼Œä½†æ˜¯å®ƒä¸ä¼šæŠŠæ–°çš„ state å’Œæ—§çš„ state è¿›è¡Œåˆå¹¶ã€‚
åœ¨ä¸‹ä¸€æ¬¡é‡æ–°æ¸²æŸ“æ—¶ï¼ŒuseState è¿”å›ç»™æˆ‘ä»¬å½“å‰çš„ stateã€‚
```javascript
import React, { useState } from 'react';

function Example() {
  // å£°æ˜ä¸€ä¸ªå« â€œcountâ€ çš„ state å˜é‡ã€‚
  const [count, setCount] = useState(0);

  return (
    <div>
      <p>You clicked {count} times</p>
      <button onClick={() => setCount(count + 1)}>
        Click me
      </button>
    </div>
  );
}
```
### useEffect
`useEffect` åªèƒ½åœ¨ç»„ä»¶çš„é¡¶å±‚æˆ–è‡ªå®šä¹‰çš„ Hook ä¸­è°ƒç”¨å®ƒã€‚`useEffect` åœ¨ DOM æ¸²æŸ“åå¼‚æ­¥è¢«è°ƒç”¨ã€‚
```typescript
useEffect(setup, dependencies?)
```

å…³äº setup

setup å¯ä»¥è¿”å›ä¸€ä¸ªå‡½æ•°ï¼ŒReact ä¼šåœ¨æ¯æ¬¡é‡æ–°æ¸²æŸ“æˆ–å¸è½½çš„æ—¶å€™éƒ½æ‰§è¡Œè¯¥å‡½æ•°ï¼ˆæ—§å€¼ï¼‰ï¼Œæ¥ç€æ‰§è¡Œ setup å‡½æ•°ï¼ˆæ–°å€¼ï¼‰ï¼Œæ‰€ä»¥å¯ä»¥åœ¨å‡½æ•°ä¸­åšæ¸…é™¤æ“ä½œã€‚

å…³äº dependency

`setup` ä¸­æ‰€ä¾èµ–çš„ props, state, variable and function çš„æ•°ç»„ã€‚æ•°ç»„æ•°é‡è¦ä¿æŒä¸å˜ã€‚ React ä½¿ç”¨ `Object.is` æ¥å’Œæ—§å€¼æ¯”è¾ƒæ˜¯å¦æœ‰å˜åŒ–ã€‚
å¦‚æœæƒ³æ‰§è¡Œåªè¿è¡Œä¸€æ¬¡çš„ effectï¼ˆä»…åœ¨ç»„ä»¶æŒ‚è½½å’Œå¸è½½æ—¶æ‰§è¡Œï¼‰ï¼Œå¯ä»¥ä¼ é€’ä¸€ä¸ªç©ºæ•°ç»„ï¼ˆ[]ï¼‰ä½œä¸ºç¬¬äºŒä¸ªå‚æ•°ã€‚å¦‚æœå¿½ç•¥ç¬¬äºŒä¸ªå‚æ•°ï¼Œeffect æ¯æ¬¡æ¸²æŸ“éƒ½ä¼šè°ƒç”¨ã€‚

æ¯æ¬¡æ¸²æŸ“åéƒ½æ‰§è¡Œæ¸…ç†æˆ–è€…æ‰§è¡Œ effect å¯èƒ½ä¼šå¯¼è‡´æ€§èƒ½é—®é¢˜ã€‚åœ¨ class ç»„ä»¶ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡åœ¨ componentDidUpdate ä¸­æ·»åŠ å¯¹ prevProps æˆ– 
prevState çš„æ¯”è¾ƒé€»è¾‘è§£å†³ã€‚åœ¨Effect Hookä¸­ï¼Œä¼ é€’æ•°ç»„ä½œä¸ºç¬¬äºŒä¸ªå‚æ•°å³å¯ã€‚åªæœ‰æ•°ç»„æŒ‡å®šçš„å˜é‡æ”¹å˜æ—¶ï¼Œæ‰ä¼šé‡æ–°è°ƒç”¨Effectã€‚

#### state updater for dependency defined inside component
If some of your dependencies are objects or functions defined inside the component, there is a risk that they will cause
the Effect to **re-run more often than needed**. To fix this, **remove unnecessary object and function dependencies.** 
You can also extract state updates.

```typescript
import { useState, useEffect } from 'react';

export default function Counter() {
  const [count, setCount] = useState(0);

  useEffect(() => {
    const intervalId = setInterval(() => {
      // setCount(count + 1); // You want to increment the counter every second...
      setCount(c => c + 1); // âœ… Pass a state updater
    }, 1000);
    return () => clearInterval(intervalId);
  // }, [count]); // ğŸš© ... but specifying `count` as a dependency always resets the interval.
  }, []); // âœ… Now count is not a dependency

  return <h1>{count}</h1>;
}
```

#### useLayoutEffect
`useLayoutEffect` åœ¨ DOM è¢«æ¸²æŸ“å‰åŒæ­¥è¢«è°ƒç”¨ï¼Œé¿å…äº†é¡µé¢é—ªçƒçš„é—®é¢˜ã€‚

### è‡ªå®šä¹‰Hook
åœ¨ React ä¸­è§£å†³å…±äº«ç»„ä»¶ä¹‹é—´çš„çŠ¶æ€é€»è¾‘é—®é¢˜çš„æœ‰: render propsï¼Œé«˜é˜¶ç»„ä»¶å’Œè‡ªå®šä¹‰Hookã€‚

- è‡ªå®šä¹‰ Hook æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå…¶åç§°ä»¥ â€œuseâ€ å¼€å¤´ï¼Œå‡½æ•°å†…éƒ¨å¯ä»¥è°ƒç”¨å…¶ä»–çš„ Hookã€‚
- è¿”å›å€¼å’Œå‚æ•°æ²¡æœ‰é™åˆ¶
- åœ¨ä¸¤ä¸ªç»„ä»¶ä¸­ä½¿ç”¨ç›¸åŒçš„ Hook ä¸ä¼šå…±äº« stateã€‚

## èµ„æ–™
https://react.dev/
